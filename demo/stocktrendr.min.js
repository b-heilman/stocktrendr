;(function(){
/** stocktrendr v0.0.1 **/
!function(a){var b="undefined"==typeof require?a.bMoor:require("bmoor");b.make("stocktrendr.DataSet",[function(){return{construct:function(a,b){var c,d,e;for(this.values=a,this.key=b,this.hash={},d=0,e=this.values.length;e>d;d++)c=this.values[d],this.hash[c[b]]=c},properties:{deflateNode:function(a){return"object"==typeof a?a[this.key]:void 0},deflateNodes:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b++)d.push(this.deflateNode(a[b]));return d},inflateNode:function(a){return void 0===a?void 0:this.hash[a]},inflateNodes:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b++)d.push(this.inflateNode(a[b]));return d},comparisons:{">":function(a,b){return a>b},">=":function(a,b){return a>=b},"<":function(a,b){return b>a},"<=":function(a,b){return b>=a},"==":function(a,b){return a==b},"===":function(a,b){return a===b},"~":function(a,b){var c=.01*a;return a+c>b&&b>a-c}},getComparator:function(a){var b=this.comparisons[a];if(b)return b;throw"could not compare with symbol: "+a}}}}])}(this),function(a){var b="undefined"==typeof require?a.bMoor:require("bmoor");b.make("stocktrendr.Expression",[function(){return{construct:function(a){var b,c,d,e,f,g,h,i,j=0,k=[];if("string"==typeof a)if(a=a.replace(/ /g,""),g=a.indexOf("("),h=a.indexOf("="),-1!==g){for(-1!==h&&g>h?(e=a.substring(0,h).trim(),h++):h=0,f=a.substring(h,g).trim(),i=g+1,b=g+1,c=a.length;c>b;b++)d=a.charAt(b),","===d&&0===j?(k.push(a.substring(i,b).trim()),b++,i=b):"("===d?j++:")"===d&&(0===j?(k.push(a.substring(i,b).trim()),b++,i=b):j--);this.name=e,this.method=f,this.operation=f+"("+k.join(",")+")",this.reference=this.name||this.operation,this.args=k}else this.reference=a;else this.inflate(a)},properties:{inflate:function(a){this.name=a.name,this.method=a.method,this.operation=a.operation,this.reference=a.reference,this.args=a.args,this.type=a.type},deflate:function(){return{name:this.name,method:this.method,operation:this.operation,reference:this.reference,args:this.args,type:this.type}}}}}])}(this),function(a){var b;"undefined"==typeof require?b=a.bMoor:(b=require("bmoor"),require("./Expression"),require("./StatPack")),b.make("stocktrendr.Expressor",["stocktrendr.Expression","stocktrendr.StatPack",function(a,b){return{construct:function(a,b){this.dataSet=a,this.variables=[],this.expressions={},b&&this.inflate(b)},properties:{deflate:function(){var a,b,c,d={};for(c in this.expressions)this.expressions.hasOwnProperty(c)&&(b=this.expressions[c],a=b.deflate(),b.results&&(a.results=this.dataSet.deflateNodes(b.results)),d[c]=a);return{variables:this.variables,expressions:d}},inflate:function(b){var c,d,e;this.variables=b.variables;for(e in b.expressions)b.expressions.hasOwnProperty(e)&&(d=b.expressions[e],c=new a(d),d.results&&(c.results=this.dataSet.inflateNodes(d.results)),this.expressions[e]=c)},express:function(b){var c=new a(b),d=c.reference;if(c.method){if(!this.expressions[d]&&this[c.method])c.results=this[c.method](c),this.expressions[d]=c,c.name&&this.variables.push(c.name);else if(!this[c.method])throw"unsupported method: "+c.method+" -> "+b}else this.expressions[d]||(this.expressions[d]=c);return this.expressions[d]},average:function(a){var c,d,e;return a.args.length>2?(e=parseInt(a.args[0],10),d=parseInt(a.args[1],10),c=this.express(a.args[2]).reference):(e=parseInt(a.args[0],10),c=this.express(a.args[1]).reference,d=0),a.type="number",b.calcAverage(this.dataSet.values,e,d,a.reference,c)},offset:function(a){var c=this.express(a.args[1]);return a.type=c.type||"number",b.findOffset(this.dataSet.values,parseInt(a.args[0],10),a.reference,c.reference)},percent:function(a){var c=this.express(a.args[1]),d=a.args[0];return d="+"==d.charAt(0)?parseInt(d.substring(1),10)+100:parseInt(d,10),a.type="number",b.calcPercent(this.dataSet.values,d,a.reference,c.reference)},test:function(a){var c=this.express(a.args[0]).reference,d=this.express(a.args[2]).reference,e=this.dataSet.getComparator(a.args[1]);return a.type="boolean",b.test(this.dataSet.values,a.reference,function(a){return void 0!==a[c]&&void 0!==a[d]&&e(a[c],a[d])})},variance:function(a){var c=this.express(a.args[0]).reference;return offset=this.express("offset("+a.args[2]+","+c+")").reference,percent=this.express("percent("+a.args[3]+","+offset+")").reference,test=this.dataSet.getComparator(a.args[1]),a.type="boolean",b.test(this.dataSet.values,a.reference,function(a){return void 0!==a[c]&&void 0!==a[percent]&&test(a[c],a[percent])})},trend:function(a){var c=this.express(a.args[0]),d=this.dataSet.getComparator(a.args[1]);return a.type="boolean",b.matchTrend(this.dataSet.values,parseInt(a.args[2],10),a.reference,c.reference,d)},point:function(a){var c,d,e,f,g="";for(a.type="boolean",c=0,d=a.args.length;d>c;c++)e=a.args[c],c&&(g+=" && "),f=this.express(e),g+='point["'+f.reference+'"]';return b.test(this.dataSet.values,a.reference,new Function(["point"],"return "+g+";"))},pattern:function(a){var c,d,e,f,g,h="",i=[],j=[],k={};for(a.type="boolean",d=0,e=a.args.length;e>d;d++)f=a.args[d],d&&(h+=" && "),g=this.express(f),i.push("v"+d),h+="v"+d+'["'+g.reference+'"]',k[g.reference]||(k[g.reference]=!0,j=j.concat(g.results));if(j.length)for(c=j.sort(function(a,b){return a.date-b.date}),d=0,e=c.length-1;e>d;d++)c[d].date===c[d+1].date&&(c.splice(d+1,1),e--,d--);return b.matchPatterns(c,a.reference,new Function(i,"return "+h+";"))}}}}])}(this),function(a){var b="undefined"==typeof require?a.bMoor:require("bmoor");b.define("stocktrendr.StatPack",{test:function(a,b,c){var d,e,f,g=[];try{for(d=0,e=a.length;e>d;d++)f=a[d],c(f)&&(f[b]=!0,g.push(f))}catch(h){console.log("test",h,d,e)}return g},calc:function(a,b,c,d,e){var f,g,h;try{for(f=0,g=a.length;g>f;f++)h=a[f],h[d]=e(h[b],h[c])}catch(i){console.log("test",i,f,g)}return a},calcAverage:function(a,b,c,d,e){var f,g,h,i,j,k,l=[];arguments.length<5&&(e=d,d=c,c=0),h=b+c+1;try{for(j=0,f=0,g=h;g>f;f++)j+=a[f][e];for(i=a[b],i[d]=j/h,l.push(i),f=h,g=a.length;g>f;f++)k=a[f-h],i=a[f-c],j=j-k[e]+a[f][e],i[d]=j/h,l.push(i)}catch(m){console.log(m,f,g)}return l},calcPercent:function(a,b,c,d){var e,f,g,h;h=b>0?parseInt(b,10)/100:(100+parseInt(b,10))/100;try{for(e=0,f=a.length;f>e;e++)g=a[e],g[c]=g[d]*h}catch(i){console.log("test",i,e,f)}return a},findOffset:function(a,b,c,d){var e,f,g,h;try{for(h=b,e=0,f=a.length;f>e;e++,h++)g=a[e],g[c]=0>h?a[0][d]:f>h?a[h][d]:a[a.length-1][d]}catch(i){console.log("calcChange",i,e,f)}return a},matchTrend:function(a,b,c,d,e){var f,g,h,i,j,k,l=[];try{if(b>0)for(f=0,g=a.length-b;g>f;){for(j=a[f],k=!0,h=f,i=f+b;i>h&&k;)h++,k=e(j[d],a[h][d]);k?(l.push(j),j[c]=k,f+=b):f=h}else for(b*=-1,f=a.length-1;f>b;){for(j=a[f],k=!0,h=f,i=f-b;h>i&&k;)h--,k=e(j[d],a[h][d]);k?(l.push(j),j[c]=k,f-=b):f=h}}catch(m){console.log("matchTrend",m,f,g)}return l},matchPatterns:function(a,b,c){for(var d=c.length,e=d-1,f=0,g=a.length-e,h=[];g>f;)c.apply(a,a.slice(f,f+d))&&(a[f+e][b]=!0,h.push(a[f+e])),f++;return h}})}(this);
//# sourceMappingURL=stocktrendr.min.js.map
}());